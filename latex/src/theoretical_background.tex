\section{Lattices}

The starting point for lattice based cryptography are, quite evidently, lattices. The first part of this chapter focuses on giving an adequate background on lattices. For the sake of brevity and clarity, the following sections will focus on lattices on $\mathbb{R}^n$. Although lattices can potentially be defined using any vector space, this would overburden this introductory chapter with unnecessary notation, distracting the reader from the concepts necessary for building lattice based cryptographic primitives.

\subsection{Generic Lattices}

\begin{definition}[Lattice]
Let $\{b_0,\ldots,b_{n-1}\}$ be a set of linearly independent vectors in $\mathbb{R}^m$, with $m\geq n$. The lattice generated by $\{b_0,\ldots,b_{n-1}\}$ is defined as the set of integer linear combinations of the $b_i$
\begin{equation*}
\mathscr{L}=\left\{\sum_{i=0}^{n-1}l_ib_i | l_i\in\mathbb{Z}\right\}
\end{equation*}
The set $B=\{b_0,\ldots,b_{n-1}\}$ is called a basis of the lattice, $n$ is called lattice rank, and $m$ lattice dimension. If $m=n$, the lattice is said to be a full rank lattice.
\end{definition}

\begin{definition}[Span of a Lattice]
Let $\mathscr{L}$ be a lattice and $B$ a basis for $\mathscr{L}$. The span of the lattice is defined as the linear space spanned by its vectors:
\begin{equation*}
span(\mathscr{L}) = span(B) = \{B\mathbf{x}|\mathbf{x}\in\mathbb{R}^n\}
\end{equation*} 
\end{definition}

\begin{remark}
It is immediate that given two lattices $\mathscr{L}$, $\mathscr{L}'$, then $\mathscr{L}\subset \mathscr{L}' \Rightarrow span(\mathscr{L}) \subset span(\mathscr{L}')$.
\end{remark}

It is worth to introduce an alternative notation for lattices. Let's consider the matrix $B$, with columns $b_0,\ldots,b_{n-1}$. It is easy to see that the lattice generated by $b_0,\ldots,b_{n-1}$ is the set $\mathscr{L}=\{B\mathbf{v}|\mathbf{v}\in\mathbb{Z}^n\}$.\\
Moreover, all of the lattices interesting for lattice based cryptography are full rank lattices, so from now on whenever a lattice is mentioned, it will be assumed to be full rank, i.e. $\mathscr{L}\subset\mathbb{R}^n$.\\
Let's introduce some useful notions on lattices.

\begin{definition}[Minimum distance]
The minimum distance of a lattice $\mathscr{L}$ is defined as the minimum distance between any two lattice points
\begin{equation*}
\lambda = min\{\norm{\mathbf{x}-\mathbf{y}}|\mathbf{x}\ne \mathbf{y}, \mathbf{x},\mathbf{y}\in\mathscr{L}\}
\end{equation*}
Since a lattice is an addictive subgroup of $\mathbb{R}^n$, the above definition is equivalent to
\begin{equation*}
min\{\norm{\mathbf{x}}|\mathbf{x}\ne0, \mathbf{x}\in\mathscr{L}\}
\end{equation*}
\end{definition}

The previous definition can be generalized to a set of linearly independent vectors as follows
\begin{definition}[i-th Successive Minimum]
The i-th successive minimum of a lattice is defined as 
\begin{equation*}
\lambda_i = min\{r \in \mathbb{R}|\exists \{\mathbf{v_i}\}_{i=0}^{n-1} \subset \mathscr{L},\text{ }linearly\text{ }independent,\text{ }s.t.\text{ }\norm{\mathbf{v_i}}\leq r\}
\end{equation*}
\end{definition}

\begin{remark}
It is immediate to see that $\lambda=\lambda_0$
\end{remark}

\begin{definition}[Dual Lattice]
The dual lattice $\mathscr{L}^*$ of a lattice $\mathscr{L}$ is defined as the set
\begin{equation*}
\mathscr{L}^*=\{\mathbf{w}\in\mathbb{R}^n|\forall\mathbf{x}\in\mathscr{L}\langle\mathbf{w},\mathbf{x}\rangle\in\mathbb{Z}\}
\end{equation*}
\end{definition} 

\begin{theorem}
Let $\mathscr{L}$ be a lattice, and $B$ its basis, then the matrix $D=B(B^{t}B)^{-1}$ is a basis for $\mathscr{L}^*$
\end{theorem}
\begin{proof}
Let's call $\tilde{\mathscr{L}}$ the lattice generated by $D$.\\
First of all, $\forall{D\mathbf{y}} \in \tilde{\mathscr{L}}$, it holds
\begin{equation*}
D\mathbf{y} = (B(B^{t}B)^{-1})\mathbf{y} = B(B^{t}B)^{-1}\mathbf{y}) \in span(\mathscr{L})
\end{equation*}
moreover, $\forall B\mathbf{x}\in\mathscr{L}$,
\begin{equation*}
\begin{aligned}
\langle D\mathbf{y},B\mathbf{x} \rangle = (D\mathbf{y})^{t}B\mathbf{x} = \mathbf{y}^{t} (B^tB)^{-1}B^tB\mathbf{x}\\
= \mathbf{y}^{t} B^{-1}(B^t)^{-1}B^tB\mathbf{x} = \mathbf{y}^t\mathbf{x} \in \mathbb{Z}^n
\end{aligned}
\end{equation*}
since $\mathbf{x}$ and $\mathbf{y}$ are vectors of coefficients for elements of the lattices $\mathscr{L}$ and $\tilde{\mathscr{L}}$. Then $D\mathbf{y}\in\mathscr{L}^*$, which means that $\tilde{\mathscr{L}}\subset\mathscr{L}^*$.\\
Now, consider $\mathbf{v}\in\mathscr{L}^*$. By definition of dual, $B^t\mathbf{v}\in\mathbb{Z}^n$. As stated above, it also holds that $\mathbf{v}\in span(\mathscr{L})$, which means that $\exists\mathbf{w}\in\mathbb{R}^n$ $s.t.$ $\mathbf{v}=B\mathbf{w}$. Then
\begin{equation*}
\mathbf{v} = B\mathbf{w} = B(B^tB)^{-1}B^tB\mathbf{w} = DB^t\mathbf{v} \in \mathscr{L}^*
\end{equation*}
since $B^t\mathbf{v}\in\mathbb{Z}^n$, which means that $\mathscr{L}^*\subset\tilde{\mathscr{L}}$, thus concluding the proof.
\end{proof}

\begin{definition}[Fundamental Parallelepiped]
Given a lattice $\mathscr{L}$, and $B$ a basis for $\mathscr{L}$, the fundamental parallelepiped of $\mathscr{L}$ is defined as the set
\begin{equation*}
\mathscr{P} = \{B\mathbf{x}|\mathbf{x}\in\mathbb{R}^n, \forall i \in \{0,\ldots,n-1\}:0\leq x_i \leq 1 \}
\end{equation*}
\end{definition}

\begin{remark}
The fundamental parallelepiped is a really useful concept in lattices. Indeed, it is easy to see that placing a fundamental parallelepiped at every vector of the lattice $\mathscr{L}$, it is possible to tessellate the entirety of $span(\mathscr{L})$.
\end{remark}

\begin{definition}[Voronoi Cell]
Given a lattice $\mathscr{L}$, and $B$ a basis for $\mathscr{L}$, the Voronoi cell of $\mathscr{L}$, with center in $\mathbf{y}\in\mathscr{L}$ is defined as the set
\begin{equation*}
\mathscr{V}_\mathbf{y} = \{\mathbf{x}\in\mathbb{R}^n|\forall \mathbf{y}' \in \mathscr{L}\backslash\mathbf{y}, \norm{\mathbf{x}-\mathbf{y}} < \norm{\mathbf{x}-\mathbf{y}'} \}
\end{equation*}
The fundamental Voronoi cell is defined as $\mathscr{V}_0$. 
\end{definition}

\begin{remark}
The geometry of the Voronoi cell depends on the metric used over $\mathbb{R}^n$. For the purpose of lattice based cryptography, this metric will always be the euclidean distance. So, from now on, any time a Voronoi cell is mentioned, it will be intended as the Voronoi cell computed using the euclidean distance.
\end{remark}

The concept of Voronoi cell is especially important for lattice based cryptography. The nature of this importance will be discussed in more detail later.\\
All of these definitions apply to generic lattices, but there are two subclasses of lattices that are of particular interest for lattice based cryptography: $q$-ary lattices and ideal lattices. While the former can be quickly introduced, the latter require a section of their own.

\begin{definition}
Let $\mathscr{L}\subset\mathbb{Z}^n$ be a lattice. $\mathscr{L}$ is said $q$-ary for some $q\in\mathbb{Z}^n$, if $q\mathbb{Z}\subset\mathscr{L}$.
\end{definition} 

\begin{remark}
If $\mathscr{L}$ is a $q$-ary lattices, and $\mathbf{x}\in\mathscr{L}$ a vector, then $x+q\mathbb{Z}^n\in\mathscr{L}$, since $q\mathbb{Z}\subset\mathscr{L}$ and $\mathscr{L}$ is an additive group, but this means that $\forall\mathbf{x}\in\mathbb{Z}^n, \mathbf{x}\in\mathscr{L}\Leftrightarrow\mathbf{x}$ $mod$ $q\in\mathscr{L}$
\end{remark}

\subsection{Ideal Lattices}

Following the same spirit of the premise made at the beginning of the chapter, the definition and properties of Ideal Lattices will not be enunciated in general terms, but they will be restricted to the cases relevant in the construction of lattice based primitives.

\begin{definition}[Ideal Lattice]
$\mathscr{L}$ is said to be an Ideal Lattice, if it is an ideal of a ring of the form $\mathbb{Z}[x]/<f>$, where f is an irreducible polynomial.  
\end{definition}

%TODO Body

Still, operation in this kind of lattices requires a lot of polynomial products, which are not exactly a fast operation if performed naively. Luckily, it is possible to speed up these operations using the Number Theoretical Transform, which allows to convert polynomial product in simple component-wise products between arrays. 

\subsection{Hard problems in lattices}
In this section are introduced the hard problems behind the security of lattice based cryptography primitives. None of the additional structure of ideal lattices is used in the definition of this problems, making these definitions valid both for generic and ideal lattices.

\subsubsection{SVP}

The main formulation for the SVP is the search problem defined as follows.

\begin{definition}[Search Shortest Vector Problem (SVP)]
Let $\mathscr{L}$ be a lattice, and $B$ a basis for $\mathscr{L}$, the SVP consists in finding $\mathbf{v}\in\mathscr{L}$ $s.t.$ $\norm{\mathbf{v}} = \lambda$, where $\lambda$ is the minimum distance of the lattice $\mathscr{L}$.
\end{definition}

It is also possible to give a decisional formulation, defined as follows.

\begin{definition}[Decisional SVP]
Let $\mathscr{L}$ be a lattice, and $B$ a basis for $\mathscr{L}$, given $\mathbf{v}\in\mathscr{L}$, determine if $\norm{\mathbf{v}} = \lambda$.
\end{definition}

The SVP problem can also be generalized as follows.

\begin{definition}[Shortest Independent Vectors Problem (SIVP)]
Let $\mathscr{L}$ be a lattice, and $B$ a basis for $\mathscr{L}$, find a set $S={s_i}_{i=0}{n-1}\subset \mathscr{L}$ of linearly independent vectors $s.t$ $\forall i$ $\norm{\mathbf{s_i}} = \lambda_i$, where $\lambda_i$ is i-th successive minimum of the lattice $\mathscr{L}$.
\end{definition}

Moreover, it is worth introducing the approximate problems $SVP_\gamma$, $SIVP_\gamma$ and $GapSVP_\gamma$, which are often more useful in security reductions than the exact counterpart.

\begin{definition}[Approximate SVP]
Let $\mathscr{L}$ be a lattice, $B$ a basis for $\mathscr{L}$, and $\gamma(n)\geq1$ the approximation factor, find a $\mathbf{v}\in\mathscr{L}\backslash0$ $s.t.$ $\norm{\mathbf{v}} \leq \gamma(n)\lambda$.
\end{definition}

\begin{definition}[\text{Approximate SIVP (SIVP$_\gamma$)}]
Let $\mathscr{L}$ be a lattice, $B$ a basis for $\mathscr{L}$, and $\gamma(n)\geq1$ the approximation factor, find a set $S={s_i}_{i=0}{n-1}\subset \mathscr{L}$ of linearly independent vectors $s.t$ $\forall i$ $\norm{\mathbf{s_i}} \leq \gamma(n)\lambda_i$.
\end{definition}

\begin{definition}[\text{Approximate Decisional SVP (GapSVP$_\gamma$)}]
Let $\mathscr{L}$ be a lattice, $B$ a basis for $\mathscr{L}$, and $\gamma(n)\geq1$ the approximation factor, tell which holds between $\lambda\leq1$ or $\lambda > \gamma(n)$.
\end{definition}
\begin{remark}
An algorithm to solve the GapSVP$_\gamma$ is allowed to error if neither of the options are true.
\end{remark}

\subsubsection{CVP}
The CVP problem family is closely related to the SVP. Indeed, it can be seen as a generalization of it.

\begin{definition}[Search CVP]
Let $\mathscr{L}$ be a lattice, $B$ a basis for $\mathscr{L}$, and a vector $\mathbf{v}\in\mathscr{\mathbb{R}^n}$, find the vector $\mathbf{w}\in\mathscr{L}$ $s.t.$ $\forall\mathbf{y}\in\mathscr{L},\norm{\mathbf{v}-\mathbf{w}} < \norm{\mathbf{v}-\mathbf{y}}$.
\end{definition}

Similarly to the SVP, there are alternative formulations, such as the Decisional and Approximate SVP. All of them can be derived as they were in the SVP setting.

\subsubsection{BDD}

\begin{definition}[\text{Bounded Distance Decoding ($\alpha$-BDD)}]
Let $\mathscr{L}$ be a lattice, $B$ a basis for $\mathscr{L}$, $\alpha\in[0,1]$, and $\mathbf{t}\in\mathbb{R}^n$. Assuming that $\exists \mathbf{y}\in\mathscr{L},\norm{\mathbf{t}-\mathbf{y}} < \alpha\lambda$, find the unique lattice vector $\mathbf{v}\in\mathscr{L}$ $s.t.$ $\norm{\mathbf{t}-\mathbf{v}}<\alpha\lambda$.
\end{definition}

\begin{remark}
An algorithm to solve the $\alpha$-BDD is allowed to error if the bound on the distance is not satisfied.
\end{remark}

\subsubsection{SIS}

\begin{definition}[Short Integer Solution Problem]
Given $B\in\mathbb{Z_q^{m\times n}}$, and $\alpha > 0$, find $\mathbf{x}\in[-\alpha,\alpha]^m\backslash{0}$, $s.t.$ $B\mathbf{x}=0$ $mod$ $q$.
\end{definition}

\begin{remark}
An approximate formulation of SIS is possible and useful, while the decisional formulation is not an hard problem, so it is not to be used.
\end{remark}

\section{Noise Distributions}
Lattice based cryptography schemes heavily rely on short random vector, typically sampled from a Discrete Gaussian distribution, used to perturb lattice elements. This section introduces a few relevant concepts on this topic.\\

\begin{definition}[Discrete Gaussian Distribution]

\end{definition}

\section{NTT}\label{sec:bg:ntt}

The NTT

Let's see how the NTT works. In a nutshell, it is a specialized from of the Discrete Fourier Transform that works on number fields. Indeed, the DFT works on complex vectors as follows.

\begin{definition}
Let $\mathbf{x}\in\mathbb{C}^n$, the DFT of $\mathbf{x}$ is defined as
\begin{equation*}
DFT(\mathbf{x})=\left(\sum_{m=0}^{n-1}x_me^{-ikm2\pi/n} \right)_{i=0}^{n-1}
\end{equation*}
\end{definition}

The core idea to bring this notion to number fields, is to replace the term $e^{-i2\pi/n}$, which is an $n$-th root of unity, with some integer $W_n$, which is itself an $n$-th root of the unity in the considered number field, if any.\\
For the sake of brevity and clarity, the considered number field will be $\mathbb{Z}_q^n$, with $q$ prime, so that $\mathbb{Z}_q$ is assured to have at least one $n$-th root of unity, as long as $n|(q-1)$, i.e. it is just a matter of parameter choice. %TODO Investigate

\begin{definition}[NTT]
Let $\mathbf{x}\in\mathbb{Z}_q^n$, $q$ prime, and $W_n\in\mathbb{Z}_q^n$ an $n$-th root of unity. Then, the NTT of $\mathbf{x}$ is defined as
\begin{equation*}
NTT(\mathbf{x})=\left(\sum_{m=0}^{n-1}x_mW_n^{km}\text{ }mod\text{ }q,\text{ }\right)_{k=0}^{n-1}  
\end{equation*}
The inverse transformaion, can then be computed as
\begin{equation*}
NTT^{-1}(\mathbf{x})=\left(n^{-1}\sum_{m=0}^{n-1}x_mW_n^{-km}\text{ }mod\text{ }q,\text{ }\right)_{k=0}^{n-1}
\end{equation*} 
\end{definition}

\begin{remark}
The NTT can be formulated alternatively defining the matrix $W=[W_n^{km}$ $mod$ $q]_{(k,m)\in\{0,\ldots,n-1\}\times\{0,\ldots,n-1\}}$. With the matrix $W$, the NTT of $\mathbf{x}\in\mathbb{Z}_q^n$ can be computed as $W\mathbf{x}^t$.
\end{remark}

Although the NTT does not have the same frequency interpretation of the DFT, it still has some similar properties. The most interesting property from the point of view of lattice based cryptography is the convolutional product, which behaves similarly to the one defined for the DFT.

\begin{definition}[Circular Convolution]
Let $\mathbf{x},\mathbf{y}\in\mathbb{Z}_q^n$, $q$ prime. Then, the convolution of $\mathbf{x}$ and $\mathbf{x}$ is defined as
\begin{equation*}
\mathbf{x}\ast\mathbf{y} = \sum_{m=0}^{n-1}x_my_{(n-m-1)}
\end{equation*}
\end{definition}

\begin{theorem}[Convolutional product]
Let $\mathbf{x},\mathbf{y}\in\mathbb{Z}_q^n$, $q$ prime. Then
\begin{equation*}
\mathbf{x}\ast\mathbf{y} = NTT^{-1}(NTT(\mathbf{x}) \circ NTT(\mathbf{y}))
\end{equation*}
\end{theorem}
\begin{proof}

\end{proof}

This is already a step in the good direction, as it is already possible to compute the product of two polynomials with the convolutional product. On the other hand, for the circular convolution to yield the product of two polynomials, the vectors of coefficients fed into it need to be padded with n zeros, thus requiring the convolution of vectors of dimension $2n$. This issue can be solved by using the negative wrapped convolution.

\begin{definition}[Negative Wrapped Convolution]
Let $\mathbf{x},\mathbf{y}\in\mathbb{Z}_q^n$, $q$ prime, and $\psi$ a $2n$-th root of unity. Then, the negative wrapped convolution of $\mathbf{x}$ and $\mathbf{x}$ is defined as
\begin{equation*}
\mathbf{x}\circledast\mathbf{y} = (\psi^{-i})_{i=0}^{n-1}\circ NTT^{-1}(NTT(\mathbf{x})NTT(\mathbf{y}))
\end{equation*}
\end{definition}

Finally, with the Negative Wrapped Convolution, a polynomial product is successfully transformed into $n$-dimensional NTT transforms and component-wise multiplications.

\section{The LWE problem}
The Learning With Error problem is defined over lattices in $\mathbb{Z}_q^n$. 

\begin{definition}[Search LWE]
Let $\mathscr{L}$ be a lattice, $B$ a basis for $\mathscr{L}$, $\chi[\mathbb{Z}_q^n]$ a Discrete Gaussian Distribution, and $\mathbf{s}\in\mathbb{Z}_q^n$. Given the noisy product $\mathbb{v}=As^t + e^t$, where $e\xleftarrow{\$}\chi[\mathbb{Z}_q^n]$, find $\mathbf{s}$.
\end{definition}

\begin{remark}
The Discrete Gaussian Distribution is chosen to have width greater than $\sqrt{n}$.
\end{remark}

\begin{definition}[Decision LWE]
Let $\mathscr{L}$ be a lattice, $B$ a basis for $\mathscr{L}$, $\chi[\mathbb{Z}_q^n]$ a Discrete Gaussian Distribution, and $\mathbf{s}\in\mathbb{Z}_q^n$. Given two pairs $(A, As^t+e^t)$ and $(A,b^t)$, where $e\xleftarrow{\$}\chi[\mathbb{Z}_q^n]$ and $\mathbf{b}\xleftarrow{\$}U[\mathbb{Z}_q^n]$, distinguish the pair generated with the noisy product from the one sampled from the uniform distribution.
\end{definition}

%         Problema dell'LWE [pqc]

%                 Introduzione
%                 Presentazione del problema dell'lwe

%                         Distribuzione di errore
%                         Encoding/decoding

%                 Algoritmi (fft, fast decoding)
%                 Problematiche (rappresentazione richiede O(n^2) e la chiave vive in Zq^n)

\section{The RLWE problem}
%         Problema dell'RLWE [RLWE_security, RLWE_toolkit]

%                 Presentazione del problema dell'RLWE
%                 Problemi risolti dal'uso della struttura di anello:
%                 - Rappresentazione ora richiede solo O(n)
%                 - La chiave vive in Rq (1/n dello spazio)
%                 - Decoding piÃ¹ veloce

%         Prova di sicurezza [pqc, RLWE_security]

%                 Presentazione di SVP e SIS
%                 Riduzione di SVP e SIS a RLWE e LWE 
%                 [RLWE_security per SVP -> search-RLWE -> decisional RLWE]
%                 [SVP -> BDD -> LWE]